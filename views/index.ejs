<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" />
<link rel="stylesheet" href="/styles/style.css">

<div class="col-md-offset-1 col-lg-offset-2 col-md-10 col-lg-8">
	<div class="codrops-top">
        <button id="home" class="top-bar"><a href="/">Home</a></button>
        <button id="search" class="top-bar" onclick="chkLogin()"><a href="/house/search">Search</a></button>
          
        <button id="login" class="top-bar-right"><a href="/user/login">Login</a></button>  
        <button id="logout" class="top-bar-right" onclick="logout()">Logout</button>   
        <button id="user" class="top-bar-right-user"></button>
    </div>

    <div class="introduction">
        <h1>House Renting System</h1>
        <p>The system is for you to rent houses online</p>
    </div>
    <ul class="clearfix">
    	<% house.forEach(function(house){
        %>
        	<li class="list">
        		<table>
        			<tr>
        				<td>
        					<img src="<%=house.image%>">
        				</td>
        				<td class="top">
			                <h1 class="title"><a href=""><%=house.title%></a></h1>   
			                <p class="info">District: <%=house.title%></p>
			                <p class="info">Area: <%=house.area%> sq feet</p>
			                <p class="info">Price:<strong>$<%=house.price%>/month</strong></p>
                		</td>
        			</tr>
        		</table>
        	</li>
        <%
        });
        %>
    </ul>
    
</div>

<script type="text/javascript">
 
      window.onload = function() {
        if ("<%=req.session.username%>" == "undefined") {
       		document.getElementById("user").setAttribute("style", "display:none");
          	document.getElementById("logout").setAttribute("style", "display:none");
          	document.getElementById("login").setAttribute("style", "display:inline");     
        } else {
         	document.getElementById("user").innerHTML = "Hi, <%=req.session.username%>";
         	document.getElementById("user").setAttribute("style", "display:inline");
          	document.getElementById("logout").setAttribute("style", "display:inline");
         	document.getElementById("login").setAttribute("style", "display:none");       
        }
      }

      function chkLogin() {
      	var currentUser = "<%=req.session.username%>";
      	if (currentUser == "undefined") {
      		alert("Please login first");
      		//document.getElementById("search").className="top-bar";
      	} else {
      		//document.getElementById("search").className="active";
      	}
      	var data = new FormData();
        data.append("username", "<%=req.session.username%>");
        var xhr = new XMLHttpRequest();
        xhr.open("post", "/house/search", true);
        xhr.send(data);
      }

      function logout() {
        var data = new FormData();
        data.append("username", "undefined");
        var xhr = new XMLHttpRequest();
        xhr.open("post", "/user/logout", true);
        xhr.onload = function(e) {
            location.reload();
        };
        xhr.send(data);
      }

</script>